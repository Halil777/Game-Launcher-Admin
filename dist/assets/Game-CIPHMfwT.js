import{r as u,j as e,u as g}from"./index-B3PNkLdk.js";import{c as p,u as f,F as b,m as j}from"./index-Z0zt6mE8.js";import{a as d}from"./axios-B4uVmeYG.js";const w=({gameId:s,onClose:r,onUpload:i})=>{const[l,o]=u.useState(null),c=n=>{n.target.files&&n.target.files[0]&&o(n.target.files[0])},m=n=>{n.preventDefault(),l&&(i(l),r())};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg w-96",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Upload Image for Game ID: ",s]}),e.jsx("button",{onClick:r,"aria-label":"Close modal",children:e.jsx(p,{})})]}),e.jsxs("form",{onSubmit:m,children:[e.jsx("input",{type:"file",accept:"image/*",onChange:c,className:"mb-4"}),e.jsx("button",{type:"submit",className:"w-full py-2 bg-blue-500 text-white rounded hover:bg-blue-700",disabled:!l,children:"Upload Image"})]})]})}):null},y=async s=>{const r=localStorage.getItem("token");if(!r)throw new Error("Token not found");return(await d.post(s,{page:1,sort:"sort_by_date_desc"},{headers:{Authorization:`Bearer ${r}`}})).data},I=()=>{var h;const{data:s,error:r}=f("http://88.218.60.127:5678/game/admin/get-games",y),i=g(),[l,o]=u.useState(null);if(r)return e.jsx("div",{children:"Failed to load games"});if(!s)return e.jsx("div",{children:"Loading..."});const c=async t=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("Token not found");await d.delete(`http://88.218.60.127:5678/game/delete-game/${t}`,{headers:{Authorization:`Bearer ${a}`}}),j("http://88.218.60.127:5678/game/admin/get-games")}catch(a){console.error("Error deleting game:",a),alert(`Failed to delete game with id ${t}`)}},m=t=>{o(t)},n=async t=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("Token not found");const x=new FormData;x.append("file",t),await d.put(`http://88.218.60.127:5678/game/add-game-image/${l}`,x,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"multipart/form-data"}}),alert("Image uploaded successfully!"),o(null)}catch(a){console.error("Error uploading image:",a),d.isAxiosError(a)&&a.response?alert(`Failed to upload image: ${a.response.data.message}`):alert("Failed to upload image. Please try again.")}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Games Page"}),e.jsx("button",{onClick:()=>i("/add-game"),className:"bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700",children:"Add Game"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-1/4 py-2 px-4 text-left",children:"Title"}),e.jsx("th",{className:"w-1/4 py-2 px-4 text-left",children:"Description"}),e.jsx("th",{className:"py-2 px-4 text-center",children:"Delete"})]})}),e.jsx("tbody",{children:(h=s==null?void 0:s.games)==null?void 0:h.map(t=>e.jsxs("tr",{className:"border-b",onClick:()=>m(t.id),children:[e.jsx("td",{className:"py-2 px-4",children:e.jsx("a",{href:t.site_url,target:"_blank",rel:"noopener noreferrer",children:t.title_en})}),e.jsxs("td",{className:"py-2 px-4",children:[t.desc_en.slice(0,100),"..."]}),e.jsx("td",{className:"py-2 px-4 text-center",children:e.jsx("button",{onClick:()=>c(t.id),className:"text-red-500 hover:text-red-700","aria-label":"Delete Game",children:e.jsx(b,{})})})]},t.id))})]})}),l&&e.jsx(w,{gameId:l,onClose:()=>o(null),onUpload:n})]})};export{I as default};
